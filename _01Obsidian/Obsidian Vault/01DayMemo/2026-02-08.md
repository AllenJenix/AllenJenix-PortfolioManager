# 🛠️ Portfolio Manager Project Log

## 📅 Last Updated: 2026-02-08
## 📂 System Architecture (Data Pipeline)
*타임머신 엔진과 벤치마크 분석 모듈이 추가되어 시스템이 확장됨.*
1. **00Transaction_History.csv**: 거래 내역 (XIRR/Flow 계산용)
2. **01Asset_Summary.csv**: 월간 자산 요약 (Anchor 보정용)
3. **02Portfolio_Holdings.csv**: 현재 잔고 현황
4. **03Full_Portfolio.csv**: 현금/RP 비중 통합 완료
5. **04Daily_Asset_Ledger.csv**: 하이브리드 보간법(Interpolation) 기반 일별 원장
6. **05Performance_Data.csv**: TWR/MWR/MDD 연산 결과물
7. **06Daily_Holdings_Timeline.csv**: (New) 종목별 보유 수량 타임라인 (역산 완료)
8. **viz_timemachine.py**: (New) 포트폴리오 타임머신 대시보드 (Interactive)
9. **viz_benchmark_clean.py**: (New) 3대 지수 비교 분석기

## 🛠️ Development Log (금일 개발 요약)
- [x] **Feature**: **Portfolio Time-Machine Engine** 구현 (현재 보유량 기준 과거 수량 역산)
- [x] **Logic**: **Baseline Correction** (역산 시 발생하는 음수 잔고를 '최저점 보정'으로 해결)
- [x] **Visualization**: `Matplotlib` Slider를 활용한 인터랙티브 대시보드 개발
- [x] **UX/UI**: 타임라인 이동 시 종목별 색상이 변하지 않도록 **Color Mapping 고정** 로직 적용
- [x] **Feature**: S&P500, Nasdaq, Russell 2000 대비 **Benchmark Alpha** 분석기 구현
- [x] **Refactoring**: `yfinance` 라이브러리 업데이트(MultiIndex 이슈)에 대응하는 견고한 데이터 파싱 로직 적용

## 💡 Engineering Insights (기술적 통찰)
- **역산(Back-tracing)의 필요성**: 과거 데이터가 유실된 상황에서, 가장 정확한 '현재 데이터'를 믿고 과거를 추론하는 방식이 데이터 정합성 유지에 유리함을 확인.
- **최저점 보정(Baseline Correction)**: 단순 역산 시 '과거 매수 기록 부재'로 인해 수량이 음수가 되는 현상 발생. 이를 해결하기 위해 `Global Min`을 찾아 0으로 오프셋(Offset) 시키는 알고리즘을 도입함.
- **인지 부하(Cognitive Load) 감소**: 파이 차트가 갱신될 때마다 색상이 랜덤하게 바뀌면 사용자가 흐름을 놓침. 종목별 고유 ID에 색상을 매핑(Hash Mapping)하여 시각적 일관성을 확보함.
- **외부 API 의존성 관리**: `yfinance`의 리턴 데이터 구조가 예고 없이 변경됨(Adj Close 누락 등). 이에 대비해 `auto_adjust=False` 옵션과 컬럼 탐색 로직을 다중화(Defensive Coding)하여 안정성을 높임.

## 📝 Financial Commentary & Notes (기타 사견)
- **타임머신 관찰**: 슬라이더를 통해 과거를 복기해보니, 특정 시점(예: 1월 중순)에 급격히 비중이 늘어난 종목들이 포트폴리오 변동성에 큰 영향을 주었음을 시각적으로 확인.
- **벤치마크 결과**: 나스닥/S&P500 대비 Alpha의 존재 여부를 명확히 확인 가능해짐. (단, 일별 변동성까지 고려한 샤프 지수 등은 추후 고려)
- **개발 방향성**: FIFO(선입선출) 엔진은 HTS의 이동평균법과 괴리가 있어 사용자 경험상 혼란을 초래하므로 폐기 결정. **이동평균(Moving Average)** 기준으로 시스템을 통일함.

## ⏭️ Next Sprint (향후 개발 과제)
- [ ] **AI 주주서한 생성기**: `04`, `05`, `06` 데이터를 LLM 프롬프트용 Context로 변환하는 모듈 개발
- [ ] **가치 가중 타임머신**: 현재 수량(Quantity) 기준인 타임머신을 과거 주가(OHLCV)와 연동하여 평가액(Value) 기준으로 고도화